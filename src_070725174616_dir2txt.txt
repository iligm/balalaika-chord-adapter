==============================
üìÅ Directory Tree of: "src/"
==============================

‚îú‚îÄ‚îÄ chords_ceg.json
‚îú‚îÄ‚îÄ script.js
‚îú‚îÄ‚îÄ style.css
‚îú‚îÄ‚îÄ index.html


==============================
üìÇ Dumping file contents...
==============================

==============================
üìÑ File: chords_ceg.json
------------------------------
{
  "name": "Balalaika C-E-G",
  "tuning": ["C", "E", "G"],
  "chords": {
    "C": [
      [0, 0, 0],
      [4, 3, 5],
      [7, 8, 9],
      [0, 3, 9],
      [4, 8, 0],
      [7, 0, 5]
    ],
    "Cm": [
      [3, 3, 5],
      [7, 8, 8],
      [0, 3, 8],
      [0, 11, 0],
      [3, 8, 0],
      [7, 11, 5]
    ],
    "C7": [
      [0, 0, 3],
      [4, 6, 5],
      [10, 8, 9],
      [0, 6, 9],
      [4, 8, 3],
      [10, 0, 5]
    ],
    "Cm7": [
      [3, 6, 5],
      [10, 8, 8],
      [0, 6, 8],
      [0, 11, 3],
      [3, 8, 3],
      [10, 11, 5]
    ],
    "Cb": [
      [3, 2, 4],
      [6, 7, 8],
      [11, 11, 11],
      [3, 7, 11],
      [6, 11, 4],
      [11, 2, 8]
    ],
    "Cbm": [
      [2, 2, 4],
      [6, 7, 7],
      [11, 10, 11],
      [2, 7, 11],
      [6, 10, 4],
      [11, 2, 7]
    ],
    "Cb7": [
      [3, 5, 4],
      [9, 7, 8],
      [3, 7, 2],
      [9, 11, 4],
      [11, 5, 8],
      [11, 11, 2]
    ],
    "Cbm7": [
      [2, 5, 4],
      [9, 7, 7],
      [2, 7, 2],
      [9, 10, 4],
      [11, 5, 7],
      [11, 10, 2]
    ],
    "D": [
      [2, 2, 2],
      [6, 5, 7],
      [9, 10, 11],
      [2, 5, 11],
      [6, 10, 2],
      [9, 2, 7]
    ],
    "Dm": [
      [2, 1, 2],
      [5, 5, 7],
      [9, 10, 10],
      [2, 5, 10],
      [5, 10, 2],
      [9, 1, 7]
    ],
    "D7": [
      [2, 2, 5],
      [6, 8, 7],
      [0, 2, 7],
      [0, 10, 11],
      [2, 8, 11],
      [6, 10, 5]
    ],
    "Dm7": [
      [5, 8, 7],
      [0, 1, 7],
      [0, 10, 10],
      [2, 1, 5],
      [2, 8, 10],
      [5, 10, 5]
    ],
    "Db": [
      [1, 1, 1],
      [5, 4, 6],
      [8, 9, 10],
      [1, 4, 10],
      [5, 9, 1],
      [8, 1, 6]
    ],
    "Dbm": [
      [1, 0, 1],
      [4, 4, 6],
      [8, 9, 9],
      [1, 4, 9],
      [4, 9, 1],
      [8, 0, 6]
    ],
    "Db7": [
      [1, 1, 4],
      [5, 7, 6],
      [11, 9, 10],
      [1, 7, 10],
      [5, 9, 4],
      [11, 1, 6]
    ],
    "Dbm7": [
      [4, 7, 6],
      [11, 9, 9],
      [1, 0, 4],
      [1, 7, 9],
      [4, 9, 4],
      [11, 0, 6]
    ],
    "E": [
      [4, 4, 4],
      [8, 7, 9],
      [4, 7, 1],
      [8, 0, 4],
      [11, 0, 1],
      [11, 4, 9]
    ],
    "Em": [
      [4, 3, 4],
      [7, 7, 9],
      [4, 7, 0],
      [7, 0, 4],
      [11, 0, 0],
      [11, 3, 9]
    ],
    "E7": [
      [2, 0, 1],
      [4, 4, 7],
      [8, 10, 9],
      [2, 4, 9],
      [4, 10, 1],
      [8, 0, 7]
    ],
    "Em7": [
      [2, 0, 0],
      [7, 10, 9],
      [2, 3, 9],
      [4, 3, 7],
      [4, 10, 0],
      [7, 0, 7]
    ],
    "Eb": [
      [3, 3, 3],
      [7, 6, 8],
      [3, 6, 0],
      [7, 11, 3],
      [10, 3, 8],
      [10, 11, 0]
    ],
    "Ebm": [
      [3, 2, 3],
      [6, 6, 8],
      [10, 11, 11],
      [3, 6, 11],
      [6, 11, 3],
      [10, 2, 8]
    ],
    "Eb7": [
      [3, 3, 6],
      [7, 9, 8],
      [1, 3, 8],
      [1, 11, 0],
      [3, 9, 0],
      [7, 11, 6]
    ],
    "Ebm7": [
      [6, 9, 8],
      [1, 2, 8],
      [1, 11, 11],
      [3, 2, 6],
      [3, 9, 11],
      [6, 11, 6]
    ],
    "F": [
      [0, 1, 2],
      [5, 5, 5],
      [9, 8, 10],
      [0, 5, 10],
      [5, 8, 2],
      [9, 1, 5]
    ],
    "Fm": [
      [0, 1, 1],
      [5, 4, 5],
      [8, 8, 10],
      [0, 4, 10],
      [5, 8, 1],
      [8, 1, 5]
    ],
    "F7": [
      [3, 1, 2],
      [5, 5, 8],
      [9, 11, 10],
      [3, 5, 10],
      [5, 11, 2],
      [9, 1, 8]
    ],
    "Fm7": [
      [3, 1, 1],
      [8, 11, 10],
      [3, 4, 10],
      [5, 4, 8],
      [5, 11, 1],
      [8, 1, 8]
    ],
    "Fb": [
      [4, 4, 4],
      [8, 7, 9],
      [4, 7, 1],
      [8, 0, 4],
      [11, 0, 1],
      [11, 4, 9]
    ],
    "Fbm": [
      [4, 3, 4],
      [7, 7, 9],
      [4, 7, 0],
      [7, 0, 4],
      [11, 0, 0],
      [11, 3, 9]
    ],
    "Fb7": [
      [2, 0, 1],
      [4, 4, 7],
      [8, 10, 9],
      [2, 4, 9],
      [4, 10, 1],
      [8, 0, 7]
    ],
    "Fbm7": [
      [2, 0, 0],
      [7, 10, 9],
      [2, 3, 9],
      [4, 3, 7],
      [4, 10, 0],
      [7, 0, 7]
    ],
    "G": [
      [2, 3, 4],
      [7, 7, 7],
      [2, 7, 0],
      [7, 10, 4],
      [11, 3, 7],
      [11, 10, 0]
    ],
    "Gm": [
      [2, 3, 3],
      [7, 6, 7],
      [2, 6, 0],
      [7, 10, 3],
      [10, 3, 7],
      [10, 10, 0]
    ],
    "G7": [
      [5, 3, 4],
      [7, 7, 10],
      [5, 7, 0],
      [7, 1, 4],
      [11, 1, 0],
      [11, 3, 10]
    ],
    "Gm7": [
      [5, 3, 3],
      [5, 6, 0],
      [7, 1, 3],
      [7, 6, 10],
      [10, 1, 0],
      [10, 3, 10]
    ],
    "Gb": [
      [1, 2, 3],
      [6, 6, 6],
      [10, 9, 11],
      [1, 6, 11],
      [6, 9, 3],
      [10, 2, 6]
    ],
    "Gbm": [
      [1, 2, 2],
      [6, 5, 6],
      [9, 9, 11],
      [1, 5, 11],
      [6, 9, 2],
      [9, 2, 6]
    ],
    "Gb7": [
      [4, 2, 3],
      [6, 6, 9],
      [4, 6, 11],
      [6, 0, 3],
      [10, 0, 11],
      [10, 2, 9]
    ],
    "Gbm7": [
      [4, 2, 2],
      [4, 5, 11],
      [6, 0, 2],
      [6, 5, 9],
      [9, 0, 11],
      [9, 2, 9]
    ],
    "A": [
      [1, 0, 2],
      [4, 5, 6],
      [9, 9, 9],
      [1, 5, 9],
      [4, 9, 2],
      [9, 0, 6]
    ],
    "Am": [
      [0, 0, 2],
      [4, 5, 5],
      [9, 8, 9],
      [0, 5, 9],
      [4, 8, 2],
      [9, 0, 5]
    ],
    "A7": [
      [1, 3, 2],
      [7, 5, 6],
      [1, 5, 0],
      [7, 9, 2],
      [9, 3, 6],
      [9, 9, 0]
    ],
    "Am7": [
      [0, 3, 2],
      [7, 5, 5],
      [0, 5, 0],
      [7, 8, 2],
      [9, 3, 5],
      [9, 8, 0]
    ],
    "Ab": [
      [3, 4, 5],
      [8, 8, 8],
      [0, 4, 8],
      [0, 11, 1],
      [3, 8, 1],
      [8, 11, 5]
    ],
    "Abm": [
      [3, 4, 4],
      [8, 7, 8],
      [3, 7, 1],
      [8, 11, 4],
      [11, 4, 8],
      [11, 11, 1]
    ],
    "Ab7": [
      [0, 2, 1],
      [6, 4, 5],
      [8, 8, 11],
      [0, 4, 11],
      [6, 8, 1],
      [8, 2, 5]
    ],
    "Abm7": [
      [6, 4, 4],
      [6, 7, 1],
      [8, 2, 4],
      [8, 7, 11],
      [11, 2, 1],
      [11, 4, 11]
    ],
    "B": [
      [3, 2, 4],
      [6, 7, 8],
      [11, 11, 11],
      [3, 7, 11],
      [6, 11, 4],
      [11, 2, 8]
    ],
    "Bm": [
      [2, 2, 4],
      [6, 7, 7],
      [11, 10, 11],
      [2, 7, 11],
      [6, 10, 4],
      [11, 2, 7]
    ],
    "B7": [
      [3, 5, 4],
      [9, 7, 8],
      [3, 7, 2],
      [9, 11, 4],
      [11, 5, 8],
      [11, 11, 2]
    ],
    "Bm7": [
      [2, 5, 4],
      [9, 7, 7],
      [2, 7, 2],
      [9, 10, 4],
      [11, 5, 7],
      [11, 10, 2]
    ],
    "Bb": [
      [2, 1, 3],
      [5, 6, 7],
      [10, 10, 10],
      [2, 6, 10],
      [5, 10, 3],
      [10, 1, 7]
    ],
    "Bbm": [
      [1, 1, 3],
      [5, 6, 6],
      [10, 9, 10],
      [1, 6, 10],
      [5, 9, 3],
      [10, 1, 6]
    ],
    "Bb7": [
      [2, 4, 3],
      [8, 6, 7],
      [2, 6, 1],
      [8, 10, 3],
      [10, 4, 7],
      [10, 10, 1]
    ],
    "Bbm7": [
      [1, 4, 3],
      [8, 6, 6],
      [1, 6, 1],
      [8, 9, 3],
      [10, 4, 6],
      [10, 9, 1]
    ]
  }
}
------------------------------
üìÑ End: chords_ceg.json
==============================

==============================
üìÑ File: script.js
------------------------------
let originalChordsText = "";
const noteOrder = ['A', 'A#', 'B', 'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#'];
const chordRegex = /([A-H][b#]?)(m?(?:add|sus|dim|aj|aug|#|¬∞|\+|\-)?\d*\-?\d*)?(\n?\W)/g;
const chordRegexWithNC = /((?:[Nn]\.[Cc]\.))|([A-H][b#]?)(m?(?:add|sus|dim|aj|aug|#|¬∞|\+|\-)?\d*\-?\d*)?(\n?\W)/g;
let scrollInterval = null;
let currentFontSize = 16;
let transposeOffset = 0;

async function get_chords(){
  const response = await fetch('src/chords_ceg.json');
  const chords_ceg = await response.json();
  
  return [chords_ceg];
}

function transposeNote(note, semitones) {
  const index = noteOrder.indexOf(note);
  if (index === -1) return note;
  return noteOrder[(index + semitones + 12) % 12];
}

async function transposeChords(semitones) {
  if (!originalChordsText) return;

  let transposed = originalChordsText.replace(chordRegexWithNC, (match, nc, note, suffix, ending) => {
    if(nc) return nc;
    const base = note;
    const transposedNote = transposeNote(base, semitones);
    return transposedNote + (suffix || '') + (ending || '');
  });

  document.getElementById('chords-text').innerHTML = transposed;
  adjustColumn();
  let chordsFound = [];
    if (transposed) {
      chordsFound = Array.from(transposed.matchAll(chordRegexWithNC), m => (m[2] || '') + (m[3] || '')).filter((x) => x.trim() != '');
    }
    const chordsL = [
      await (await fetch("src/chords_ceg.json")).json()
    ];

    const uniqueChords = [...new Set(chordsFound)];
    const chordsList = document.getElementById('chords-list');
    chordsList.innerHTML = '';
    if (uniqueChords.length > 0) {
      
      uniqueChords.forEach(chord => {
        const li = document.createElement('li');
        var canvas = document.createElement('canvas');
        li.appendChild(canvas);
        chordsList.appendChild(li);
        var ctx = canvas.getContext('2d');
        drawFretboardOnCanvas(ctx, chordsL[0].tuning, getChord(chordsL[0], chord)[0], "balalaika", chord);
      });
  }
}

function changeTranspose(step) {
  transposeOffset += step;
  document.getElementById('transposeDisplay').textContent = transposeOffset;
  transposeChords(transposeOffset);
}

function changeFontSize(step) {
  currentFontSize += step;
  if (currentFontSize < 12) currentFontSize = 12;
  if (currentFontSize > 32) currentFontSize = 32;
  document.getElementById('chords-text').style.fontSize = currentFontSize + 'px';
  document.getElementById('fontSizeDisplay').textContent = currentFontSize;
}

function toggleAutoScroll() {
  const btn = document.getElementById('playPauseBtn');
  if (scrollInterval) {
    stopAutoScroll();
    btn.innerHTML = '‚ñ∂';
  } else {
    startAutoScroll();
    btn.innerHTML = `&#9724`;
  }
}

function startAutoScroll() {
  stopAutoScroll();
  const speed = parseInt(document.getElementById('scrollSpeed').value);
  if (speed <= 0) return;
  scrollInterval = setInterval(() => {
    window.scrollBy({ top: 2, behavior: 'auto' });
    if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
      stopAutoScroll();
      document.getElementById('playPauseBtn').textContent = '‚ñ∂';
    }
  }, speed);
}

function stopAutoScroll() {
  if (scrollInterval) clearInterval(scrollInterval);
  scrollInterval = null;
}

document.addEventListener('keydown', function (e) {
  if (e.code === 'Space') {
    e.preventDefault();
    toggleAutoScroll();
  }
});

function handleScrollSpeedChange() {
  if (scrollInterval) {
    startAutoScroll(); // Restart with new speed if already scrolling
  }
}


function convertToAmerican(chordsText) {
  return chordsText.replace(/(B)(m?(?:add|sus|dim|aj|aug|#|¬∞|\+|\-)?\d*\-?\d*)?(\n?\W)/g, 'A#$2$3').replace(/\b(H)(m?(?:add|sus|dim|aj|aug|#|¬∞|\+|\-)?\d*\-?\d*)?(\n?\W)/g, 'B$2$3');
}

function convertToEuropean(chordsText) {
  return chordsText.replace(/\b(B)(m?(?:add|sus|dim|aj|aug|#|¬∞|\+|\-)?\d*\-?\d*)?(\n?\W)/g, 'H$2$3').replace(/(A#)(m?(?:add|sus|dim|aj|aug|#|¬∞|\+|\-)?\d*\-?\d*)?(\n?\W)/g, 'B$2$3');
}

let NotationInit = false;

async function toggleNotation() {
  let chordsText = document.getElementById('chords-text').innerHTML;
  let chordsFound = [];
  if (chordsText) {
    chordsFound = Array.from(chordsText.matchAll(chordRegexWithNC), m => (m[2] || '') + (m[3] || '')).filter((x) => x.trim() != '');
  }
  let uniqueChords = [...new Set(chordsFound)];

  let hasEuropeanH = uniqueChords.includes("H");
  let hasAmericanB = uniqueChords.includes("B");
    
  let text = hasAmericanB && !hasEuropeanH ? convertToEuropean(chordsText) : convertToAmerican(chordsText);
  document.getElementById('chords-text').innerHTML = text;
  
  chordsFound = [];
  if (chordsText) {
    chordsFound = Array.from(text.matchAll(chordRegexWithNC), m => (m[2] || '') + (m[3] || '')).filter((x) => x.trim() != '');
  }

  uniqueChords = [...new Set(chordsFound)];

  hasEuropeanH = uniqueChords.includes("H");
  hasAmericanB = uniqueChords.includes("B");

  document.getElementById('notationBtn').textContent = !hasEuropeanH ? '–ê–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∞—è' : !hasAmericanB ? '–ù–µ –≤–ª–∏—è–µ—Ç' : '–ï–≤—Ä–æ–ø–µ–π—Å–∫–∞—è';

  const chordsL = [
    await (await fetch("src/chords_ceg.json")).json()
  ];

  const chordsList = document.getElementById('chords-list');
    chordsList.innerHTML = '';
    if (uniqueChords.length > 0) {
      
      uniqueChords.forEach(chord => {
        const li = document.createElement('li');
        var canvas = document.createElement('canvas');
        li.appendChild(canvas);
        chordsList.appendChild(li);
        var ctx = canvas.getContext('2d');
        drawFretboardOnCanvas(ctx, chordsL[0].tuning, getChord(chordsL[0], chord, hasEuropeanH)[0], "balalaika", chord);
      });

  }
}

async function parseAmdm() {
  stopAutoScroll();
  document.getElementById('playPauseBtn').textContent = '‚ñ∂';

  const url = document.getElementById('urlInput').value.trim();
  if (!url || !url.includes('amdm.ru')) {
    alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É —Å —Å–∞–π—Ç–∞ amdm.ru');
    return;
  }

  const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);

  try {
    const response = await fetch(proxyUrl);
    const html = await response.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');

    const chordsTextElement = doc.querySelector('pre.field__podbor_new');
    let chordsText = chordsTextElement ? chordsTextElement.textContent : "–ù–µ –Ω–∞–π–¥–µ–Ω";
    
    chordsText = chordsText.replace(/(\[.*\]:)/g, `$1\n`);
    chordsText = chordsText.replace(/(\/\*\ ?([\s\S]*?)\*\/)/g, `<span class="inchords-comment">$2</span>\n`);

    chordsText = chordsText.replace(chordRegexWithNC, '<span class="chord">$1$2$3</span>$4');

    originalChordsText = chordsText;
    document.getElementById('chords-text').innerHTML = chordsText;
    adjustColumn();
    
    let chordsFound = [];
    if (chordsText) {
      chordsFound = Array.from(chordsText.matchAll(chordRegexWithNC), m => (m[2] || '') + (m[3] || '')).filter((x) => x.trim() != '');
    }
    const chordsL = [
      await (await fetch("src/chords_ceg.json")).json()
    ];

    const uniqueChords = [...new Set(chordsFound)];
    const chordsList = document.getElementById('chords-list');
    chordsList.innerHTML = '';
    if (uniqueChords.length > 0) {
      
      uniqueChords.forEach(chord => {
        const li = document.createElement('li');
        var canvas = document.createElement('canvas');
        li.appendChild(canvas);
        chordsList.appendChild(li);
        var ctx = canvas.getContext('2d');
        drawFretboardOnCanvas(ctx, chordsL[0].tuning, getChord(chordsL[0], chord)[0], "balalaika", chord);
      });
    } else {
      chordsList.innerHTML = '<li>–ê–∫–∫–æ—Ä–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</li>';
    }

    const authorLinkElement = doc.querySelector('.b-author__name a[href]');
    const authorLink = document.getElementById('author-link');
    if (authorLinkElement) {
      const authorName = authorLinkElement.textContent.trim();
      const authorHref = authorLinkElement.getAttribute('href').trim();
      authorLink.textContent = authorName;
      authorLink.setAttribute('href', authorHref);
    } else {
      authorLink.textContent = '–ù–µ –Ω–∞–π–¥–µ–Ω';
      authorLink.setAttribute('href', '#');
    }

    const statsElements = doc.querySelectorAll('.b-stats .b-stats__item');
    statsElements.forEach(stat => {
      const icon = stat.querySelector('i');
      if (!icon) return;
      const text = stat.textContent.replace(icon.outerHTML, '').trim();

      if (icon.classList.contains('fa-eye')) {
        document.getElementById('views').textContent = text;
      } else if (icon.classList.contains('fa-star')) {
        document.getElementById('stars').textContent = text;
      } else if (icon.classList.contains('fa-calendar')) {
        document.getElementById('date').textContent = text;
      }
    });

    const titleElement = doc.querySelector('h1');
    if (titleElement) {
      const fullTitle = titleElement.textContent.replace(/[\s]+/g, ' ').trim();
      const match = fullTitle.match(/(.+?)\s*-\s*(.+?),/);
      if (match) {
        document.getElementById('artist').textContent = match[1];
        document.getElementById('song-title').textContent = match[2];
      } else {
        document.getElementById('artist').textContent = '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω';
        document.getElementById('song-title').textContent = fullTitle;
      }
    }

  } catch (error) {
    console.error(error);
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.');
  }
}

function getChord(chordData, chordName, useGermanNotation = false) {
  const germanNoteMap = {
    'Cis': 'C#', 'Des': 'Db', 'Ces': 'B',
    'Dis': 'D#', 'Es': 'Eb', 'Ees': 'Eb',
    'Fes': 'Eb', 'Fis': 'F#',
    'Gis': 'G#', 'Ges': 'Gb',
    'Ais': 'A#', 'As': 'Ab',
    'Bes': 'Bb', 'B': 'Bb', 'H': 'B'
  };

  const enharmonicMap = {
    "Cb": "B", "C#": "Db", "Db": "C#", "D#": "Eb", "Eb": "D#",
    "E#": "F", "Fb": "E", "F#": "Gb", "Gb": "F#", "G#": "Ab",
    "Ab": "G#", "A#": "Bb", "B#": "C"
  };

  let normalizedChordName = chordName;

  // Step 1: Convert German root note if enabled
  if (useGermanNotation) {
    const germanRootRegex = /^(Cis|Des|Ces|Dis|Es|Ees|Fes|Fis|Gis|Ges|Ais|As|Bes|B|H)/;
    const match = chordName.match(germanRootRegex);
    if (match) {
      const germanNote = match[1];
      const internationalNote = germanNoteMap[germanNote];
      if (internationalNote) {
        normalizedChordName = internationalNote + chordName.slice(germanNote.length);
      }
    }
  }

  // Step 2: Extract base note and normalize using enharmonics
  const baseMatch = normalizedChordName.match(/^([A-G][b#]?)/);
  if (!baseMatch) throw new Error(`Invalid chord name: ${chordName}`);
  const baseNote = baseMatch[1];
  const normalizedBase = enharmonicMap[baseNote] || baseNote;

  const suffix = normalizedChordName.slice(baseNote.length);
  const fullyNormalizedChordName = normalizedBase + suffix;

  // Step 3: Try exact match
  if (chordData.chords[fullyNormalizedChordName]) {
    return chordData.chords[fullyNormalizedChordName];
  }

  // Optional: Try fallbacks if needed
  if (suffix) {
    const simpleChord = normalizedBase + (suffix.startsWith('m') ? 'm' : '');
    if (chordData.chords[simpleChord]) {
      console.warn(`Chord "${fullyNormalizedChordName}" not found. Falling back to "${simpleChord}".`);
      return chordData.chords[simpleChord];
    }
  }

  // Final fallback to basic major/minor
  if (chordData.chords[normalizedBase]) {
    console.warn(`Chord "${fullyNormalizedChordName}" not found. Falling back to "${normalizedBase}".`);
    return chordData.chords[normalizedBase];
  }

  throw new Error(
    `Chord "${chordName}" (normalized to "${fullyNormalizedChordName}") not found in tuning ${chordData.tuning.join(' ')}`
  );
}

function drawFretboardOnCanvas(ctx, tuning, pressedFrets, instrumentType = 'guitar', chordName) {
  const FRET_DISTANCE_RATIO = Math.pow(2, 1 / 12);
  const DOT_PATTERN = {
    guitar: [3, 2, 2, 2, 3],
    balalaika: [2, 3, 2, 3, 2]
  };

  const STRING_SPACING = 20;
  const FRETS_START_X = 12;
  let FIRST_FRET_WIDTH = 8;

  // Determine needed frets and whether to hide zero fret
  const allPressedFrets = pressedFrets.filter(f => f !== null && f !== 0);
  let minFretToShow = 1;
  let neededFrets = 3;

  if (allPressedFrets.length > 0) {
    const maxPressedFret = Math.max(...allPressedFrets);
    const minPressedFret = Math.min(...allPressedFrets.filter((x) => x != 0));
    neededFrets = maxPressedFret - minPressedFret + 3 + (maxPressedFret == minPressedFret);
    minFretToShow = Math.max(minPressedFret - 1, 1);
  }

  // Calculate total width
  let calculatedWidth = FRETS_START_X;
  let currentX = FRETS_START_X * 2;
  for (let i = 0; i < neededFrets; i++) {
    currentX += FIRST_FRET_WIDTH / Math.pow(FRET_DISTANCE_RATIO, i);
  }
  calculatedWidth = 100;
  FIRST_FRET_WIDTH *= (calculatedWidth - FRETS_START_X * 2) / (currentX - FRETS_START_X * 2);

  const CANVAS_HEIGHT = tuning.length * STRING_SPACING + 30;
  ctx.canvas.width = calculatedWidth;
  ctx.canvas.height = CANVAS_HEIGHT;
  ctx.clearRect(0, 0, calculatedWidth, CANVAS_HEIGHT);

  // Recalculate fret positions
  let fretPositions = [];
  currentX = FRETS_START_X;
  for (let i = 0; i <= neededFrets; i++) {
    fretPositions.push(Math.round(currentX));
    currentX += FIRST_FRET_WIDTH / Math.pow(FRET_DISTANCE_RATIO, i + 1);
  }

  // Dot pattern logic
  const dotSpacing = DOT_PATTERN[instrumentType] || [2, 2, 2, 2, 2];
  let dotPositions = [];
  let pos = 0;
  for (let interval of dotSpacing) {
    pos += interval;
    dotPositions.push(pos);
  }

  ctx.fillStyle = "#555";
  for (let f = 0; f < fretPositions.length - 1; f++) {
    const globalFretNumber = f + minFretToShow;
    if (dotPositions.includes(globalFretNumber)) {
      const centerX = (fretPositions[f] + fretPositions[f + 1]) / 2;
      const centerY = 10;

      if (globalFretNumber === 12 || globalFretNumber === 24) {
        ctx.beginPath(); ctx.arc(centerX - 5, centerY, 4, 0, 2 * Math.PI); ctx.fill();
        ctx.beginPath(); ctx.arc(centerX + 5, centerY, 4, 0, 2 * Math.PI); ctx.fill();
      } else {
        ctx.beginPath(); ctx.arc(centerX, centerY, 4, 0, 2 * Math.PI); ctx.fill();
      }
    }
  }

  // Draw vertical fret lines
  ctx.lineWidth = 1;
  ctx.strokeStyle = "#999";
  for (let f = 0; f < fretPositions.length; f++) {
    const x = fretPositions[f];
    ctx.beginPath(); ctx.moveTo(x, 17); ctx.lineTo(x, tuning.length * STRING_SPACING + 3); ctx.stroke();

    // Label the fret number
    ctx.fillStyle = "black";
    const globalFretNumber = f + minFretToShow - 1;
    ctx.font = "10px Arial";
    ctx.textAlign = "center";
    ctx.fillText(globalFretNumber, x, tuning.length * STRING_SPACING + 12);
  }

  // Draw strings and markers
  ctx.lineWidth = 2;
  for (let s = 0; s < tuning.length; s++) {
    const y = 20 + s * STRING_SPACING;
    ctx.beginPath();
    ctx.moveTo(fretPositions[0], y);
    ctx.lineTo(fretPositions[fretPositions.length - 1], y);
    ctx.stroke();

    const openNote = tuning[tuning.length - s - 1];

    for (let f = 0; f < fretPositions.length; f++) {
      const globalFretNumber = f + minFretToShow;
      const x = (fretPositions[f] + (fretPositions[f + 1] || fretPositions[f])) / 2;
      const pressedFret = pressedFrets[tuning.length - s - 1];

      if (pressedFret === globalFretNumber && pressedFret != 0) {
        ctx.beginPath(); ctx.arc(x, y, 4, 0, 2 * Math.PI); ctx.fillStyle = "#4a90e2"; ctx.fill(); ctx.fillStyle = "black";
      }

      if (f === fretPositions.length - 1 && pressedFret === 0) {
        ctx.font = "10px Arial"; ctx.textAlign = "center"; ctx.fillText("O", x + 8, y + 3);
      } else if (f === fretPositions.length - 1 && (pressedFret === null || pressedFret === undefined)) {
        ctx.font = "10px Arial"; ctx.textAlign = "center"; ctx.fillText("X", x + 8, y + 3);
      }
    }

    ctx.font = "10px Arial"; ctx.textAlign = "start"; ctx.fillText(openNote, fretPositions[0] - 12, y + 3);
  }

  ctx.font = "10px Arial"; ctx.textAlign = "center"; ctx.fillText(chordName, calculatedWidth / 2, CANVAS_HEIGHT - 5);
}
------------------------------
üìÑ End: script.js
==============================

==============================
üìÑ File: style.css
------------------------------
body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #f9f9f9;
    margin: 0;
    padding: 2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
}

h1 {
    font-size: 1.5rem;
    color: #333;
    margin-bottom: 1rem;
}

.input-container {
    width: 100%;
    max-width: 600px;
    margin-bottom: 2rem;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

input[type="text"] {
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
}

input[type="text"]:focus {
    border-color: #4a90e2;
    outline: none;
}

.controls {
    display: flex;
    flex-direction: column;
    gap: 6px;
    justify-content: center;
    align-items: center;
    margin-bottom: 1rem;
    width: 100%;
    max-width: 1000px;
}

.control-row {
    display: flex;
    justify-content: space-around;
    width: 100%;
}

.control-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    min-width: 120px;
}

.control-group span.title {
    font-weight: bold;
    font-size: 0.9rem;
    margin-bottom: 4px;
}

button {
    padding: 8px 12px;
    background-color: #4a90e2;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 1rem;
    cursor: pointer;
    height: 2.25rem;
    transition: background-color 0.3s ease;
}

button.control-btn {
    background-color: #4a90e2;
    width: 2.25rem;
    height: 2.25rem;
}

button.control-btn:hover {
    background-color: #357abd;
}

.value-display {
    padding: 8px 12px;
    font-size: 1rem;
    text-align: center;
    vertical-align: middle;
    background-color: white;
    border: 1px solid #ccc;
    border-radius: 6px;
    min-width: 40px;
}

.output {
    display: flex;
    gap: 2rem;
    width: 100%;
    max-width: none;
    justify-content: flex-end;
}

#col1 {
    background-color: white;
    position: relative;
    padding: 0.5rem 0.75rem;
    margin-left: 0;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    flex: 1 1 0;
    width: auto;
    min-height: 500px;
    overflow-y: auto;
}

#col2 {
    min-width: 340px;
}

.column {
    background-color: white;
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    flex: 0 1 auto;
    overflow-y: auto;
    margin-left: auto;
}

.column h2 {
    margin-top: 0;
    font-size: 1.2rem;
    color: #444;
}

.chord {
    color: #167ac6;
    font-weight: bold;
    white-space: nowrap;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    background-color: rgba(22, 122, 198, 0.1);
    border-radius: 4px;
    display: inline-block;
}

.chord:hover {
    background-color: rgba(22, 122, 198, 0.2);
    cursor: pointer;
}

#chords-text {
    font-family: monospace;
    white-space: pre;         /* –∑–∞–ø—Ä–µ—â–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã */
    overflow-x: auto;         /* –≤–∫–ª—é—á–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
    word-break: normal;       /* —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–∞–∑–±–∏–≤–∫—É –≤–Ω—É—Ç—Ä–∏ —Å–ª–æ–≤ */
    hyphens: none;            /* –æ—Ç–∫–ª—é—á–∞–µ–º –¥–µ—Ñ–∏—Å—ã */
    min-width: 450px;
    font-size: 20px;
    padding: 0.2rem 0.3rem;
}

ul {
    list-style-type: none;
    padding-left: 0;
}

li {
    margin-bottom: 0.4rem;
}

strong {
    color: #555;
}

a {
    color: #4a90e2;
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

.inchords-comment {
    display: inline-block;
    margin-top: 0.5rem;
    margin-bottom: 1rem;
    padding: 6px 14px;
    background-color: #f1f1f1;
    border-left: 5px solid #4a90e2;
    font-family: monospace;
    white-space: pre-wrap;
    word-wrap: break-word;
    color: #555;
    border-radius: 4px;
}

@media (max-width: 1200px) {
    .output {
        flex-direction: column;
        align-items: stretch;
        gap: 1.5rem;
    }
    #col1, #col2 {
        min-width: 0;
        width: 100%;
        margin-left: 0;
    }
}
------------------------------
üìÑ End: style.css
==============================

==============================
üìÑ File: index.html
------------------------------
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ü–∞—Ä—Å–µ—Ä Amdm.ru</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>–ü–∞—Ä—Å–µ—Ä –∞–∫–∫–æ—Ä–¥–æ–≤ —Å Amdm.ru</h1>

<div class="input-container">
  <input type="text" id="urlInput" placeholder="https://amdm.ru/akkordi/–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å/–Ω–æ–º–µ—Ä/–Ω–∞–∑–≤–∞–Ω–∏–µ/" />
  <button onclick="parseAmdm()">–ü–∞—Ä—Å–∏—Ç—å –ø–æ–¥–±–æ—Ä</button>
</div>

<!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
<div class="controls">
  <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ -->
  <div class="control-row">
    <!-- –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å -->
    <div class="control-group">
      <span class="title">–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</span>
      <div style="display: flex; align-items: center; gap: 4px;">
        <button class="control-btn" onclick="changeTranspose(-1)">-</button>
        <span id="transposeDisplay" class="value-display">0</span>
        <button class="control-btn" onclick="changeTranspose(1)">+</button>
      </div>
    </div>
    <!-- –†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ -->
    <div class="control-group">
      <span class="title">–†–∞–∑–º–µ—Ä</span>
        <div style="display: flex; align-items: center; gap: 4px;">
        <button class="control-btn" onclick="changeFontSize(-1)">-</button>
        <span id="fontSizeDisplay" class="value-display">16</span>
        <button class="control-btn" onclick="changeFontSize(1)">+</button>
      </div>
    </div>
    <!-- –°–∏—Å—Ç–µ–º–∞ –Ω–æ—Ç–∞—Ü–∏–∏ -->
    <div class="control-group">    
      <span class="title">–ù–æ—Ç–∞—Ü–∏—è</span>
      <button onclick="toggleNotation()" id="notationBtn">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
    </div>
    <!-- –ê–≤—Ç–æ–ø–µ—Ä–µ–º–æ—Ç–∫–∞ -->
    <div class="control-group">
      <span class="title">–ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞</span>
      <div style="display: flex; flex-direction: row; align-items: center; gap: 4px;">
        <select id="scrollSpeed" style="font-size: 1rem; padding: 6px; height: 2.25rem;" onchange="handleScrollSpeedChange()">
          <option value="400">–ú–µ–¥–ª–µ–Ω–Ω–æ</option>
          <option value="200" selected>–°—Ä–µ–¥–Ω–µ</option>
          <option value="100">–ë—ã—Å—Ç—Ä–æ</option>
        </select>
        <button class="control-btn" onclick="toggleAutoScroll()" id="playPauseBtn">‚ñ∂</button>
      </div>
    </div>
  </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –≤—ã–≤–æ–¥ -->
<div class="output">
  <div class="column" id="col1" style="min-width: 420px;">
    <h2>–¢–µ–∫—Å—Ç –ø–æ–¥–±–æ—Ä–∞</h2>
    <pre id="chords-text" style="font-size: 16px;">–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –≤—ã—à–µ...</pre>
  </div>

  <div class="column" id="col2">
    <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
    <ul>
      <li><strong>–ê–≤—Ç–æ—Ä:</strong> <a id="author-link" href="#" target="_blank">–ù–µ –Ω–∞–π–¥–µ–Ω</a></li>
      <li><strong>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã:</strong> <span id="views">-</span></li>
      <li><strong>–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º:</strong> <span id="stars">-</span></li>
      <li><strong>–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</strong> <span id="date">-</span></li>
      <li><strong>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:</strong> <span id="artist">-</span></li>
      <li><strong>–ü–µ—Å–Ω—è:</strong> <span id="song-title">-</span></li>
      <li><strong>–ê–∫–∫–æ—Ä–¥—ã:</strong></li>
      <div style="display: flex; flex-wrap: wrap;" id="chords-list"></div>
    </ul>
  </div>
</div>
    <script type="text/javascript" module src="script.js"></script>
</body>
</html>
------------------------------
üìÑ End: index.html
==============================
